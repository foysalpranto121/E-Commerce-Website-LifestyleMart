{% extends "base.html" %}

{% block title %}{{ title }} - Admin Panel{% endblock %}

{% block content %}
<style>
.admin-container {
    background: #f8f9fa;
    min-height: 100vh;
}

.admin-sidebar {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    min-height: 100vh;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}

.admin-sidebar .nav-link {
    color: rgba(255,255,255,0.9);
    padding: 15px 20px;
    border-radius: 8px;
    margin: 5px 10px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.admin-sidebar .nav-link:hover,
.admin-sidebar .nav-link.active {
    background: rgba(255,255,255,0.2);
    color: white;
    transform: translateX(5px);
}

.admin-main {
    padding: 30px;
}

.admin-header {
    background: white;
    border-radius: 12px;
    padding: 20px 30px;
    margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.product-form {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.form-group {
    margin-bottom: 25px;
}

.form-label {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 8px;
}

.form-control,
.form-select {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 12px 15px;
    transition: all 0.3s ease;
}

.form-control:focus,
.form-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
}

.form-check-input:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-primary {
    background: var(--primary-color);
    border: none;
    padding: 12px 30px;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    background: var(--accent-color);
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    border: none;
    padding: 12px 30px;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.image-preview {
    width: 200px;
    height: 200px;
    border: 2px dashed #e9ecef;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 10px;
    overflow: hidden;
}

.image-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.image-preview .placeholder {
    color: #6c757d;
    text-align: center;
    padding: 20px;
}

.help-text {
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 5px;
}
</style>

<div class="admin-container">
    <div class="row g-0">
        <!-- Admin Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="admin-sidebar p-3">
                <div class="text-center mb-4">
                    <h4 class="text-white">Admin Panel</h4>
                    <small class="text-white-50">LIFESTYLE MART</small>
                </div>
                
                <nav class="nav flex-column">
                    <a href="{{ url_for('admin_dashboard') }}" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                    <a href="{{ url_for('admin_products') }}" class="nav-link active">
                        <i class="fas fa-box"></i>
                        Products
                    </a>
                    <a href="#" class="nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        Orders
                    </a>
                    <a href="#" class="nav-link">
                        <i class="fas fa-users"></i>
                        Users
                    </a>
                    <a href="#" class="nav-link">
                        <i class="fas fa-tags"></i>
                        Categories
                    </a>
                    <a href="#" class="nav-link">
                        <i class="fas fa-star"></i>
                        Reviews
                    </a>
                    <a href="#" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        Analytics
                    </a>
                    <a href="#" class="nav-link">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                    <a href="{{ url_for('index') }}" class="nav-link">
                        <i class="fas fa-home"></i>
                        Back to Site
                    </a>
                </nav>
            </div>
        </div>

        <!-- Admin Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="admin-main">
                <!-- Admin Header -->
                <div class="admin-header">
                    <div>
                        <h1>{{ title }}</h1>
                        <p class="text-muted mb-0">
                            {% if product %}
                                Edit product information
                            {% else %}
                                Add a new product to your inventory
                            {% endif %}
                        </p>
                    </div>
                    <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Products
                    </a>
                </div>

                <!-- Product Form -->
                <div class="product-form">
                    <form method="POST" enctype="multipart/form-data">
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            <div class="col-md-8">
                                <!-- Product Name -->
                                <div class="form-group">
                                    <label for="{{ form.name.id }}" class="form-label">
                                        Product Name <span class="text-danger">*</span>
                                    </label>
                                    {{ form.name(class="form-control", placeholder="Enter product name") }}
                                    {% if form.name.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.name.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Description -->
                                <div class="form-group">
                                    <label for="{{ form.description.id }}" class="form-label">
                                        Description
                                    </label>
                                    {{ form.description(class="form-control", rows="5", placeholder="Enter product description") }}
                                    {% if form.description.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.description.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <!-- Category -->
                                        <div class="form-group">
                                            <label for="{{ form.category_id.id }}" class="form-label">
                                                Category <span class="text-danger">*</span>
                                            </label>
                                            {{ form.category_id(class="form-select") }}
                                            {% if form.category_id.errors %}
                                                <div class="text-danger mt-1">
                                                    {% for error in form.category_id.errors %}
                                                        <small>{{ error }}</small>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Brand -->
                                        <div class="form-group">
                                            <label for="{{ form.brand.id }}" class="form-label">
                                                Brand
                                            </label>
                                            {{ form.brand(class="form-control", placeholder="Enter brand name") }}
                                            {% if form.brand.errors %}
                                                <div class="text-danger mt-1">
                                                    {% for error in form.brand.errors %}
                                                        <small>{{ error }}</small>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-4">
                                        <!-- Price -->
                                        <div class="form-group">
                                            <label for="{{ form.price.id }}" class="form-label">
                                                Price (à§³) <span class="text-danger">*</span>
                                            </label>
                                            {{ form.price(class="form-control", placeholder="0.00", step="0.01") }}
                                            {% if form.price.errors %}
                                                <div class="text-danger mt-1">
                                                    {% for error in form.price.errors %}
                                                        <small>{{ error }}</small>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <!-- Stock -->
                                        <div class="form-group">
                                            <label for="{{ form.stock.id }}" class="form-label">
                                                Stock Quantity <span class="text-danger">*</span>
                                            </label>
                                            {{ form.stock(class="form-control", placeholder="0") }}
                                            {% if form.stock.errors %}
                                                <div class="text-danger mt-1">
                                                    {% for error in form.stock.errors %}
                                                        <small>{{ error }}</small>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <!-- Featured -->
                                        <div class="form-group">
                                            <div class="form-check mt-4">
                                                {{ form.is_featured(class="form-check-input") }}
                                                <label for="{{ form.is_featured.id }}" class="form-check-label">
                                                    {{ form.is_featured.label.text }}
                                                </label>
                                            </div>
                                            <small class="help-text">Featured products appear on the homepage</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Image URL -->
                                <div class="form-group">
                                    <label for="{{ form.image.id }}" class="form-label">
                                        Image URL
                                    </label>
                                    {{ form.image(class="form-control", placeholder="Enter image URL") }}
                                    {% if form.image.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.image.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="help-text">
                                        Enter a URL to the product image. If no image is provided, a default placeholder will be used.
                                    </small>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <!-- Image Preview -->
                                <div class="form-group">
                                    <label class="form-label">Image Preview</label>
                                    <div class="image-preview" id="imagePreview">
                                        {% if product and product.image %}
                                            <img src="{{ product.image }}" alt="{{ product.name }}">
                                        {% else %}
                                            <div class="placeholder">
                                                <i class="fas fa-image fa-3x mb-2"></i>
                                                <div>No image</div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Product Info -->
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle me-2"></i>Product Tips</h6>
                                    <ul class="mb-0 small">
                                        <li>Use descriptive names for better search results</li>
                                        <li>Set competitive prices based on market research</li>
                                        <li>Keep stock levels updated to avoid overselling</li>
                                        <li>Featured products get more visibility</li>
                                        <li>High-quality images increase sales</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between pt-3 border-top">
                            <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>
                                    {% if product %}
                                        Update Product
                                    {% else %}
                                        Add Product
                                    {% endif %}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Image preview functionality
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.getElementById('{{ form.image.id }}');
    const imagePreview = document.getElementById('imagePreview');
    
    if (imageInput) {
        imageInput.addEventListener('input', function() {
            const imageUrl = this.value.trim();
            
            if (imageUrl) {
                // Create a temporary image to check if the URL is valid
                const tempImg = new Image();
                tempImg.onload = function() {
                    imagePreview.innerHTML = `<img src="${imageUrl}" alt="Product preview">`;
                };
                tempImg.onerror = function() {
                    imagePreview.innerHTML = `
                        <div class="placeholder">
                            <i class="fas fa-exclamation-triangle fa-3x mb-2"></i>
                            <div>Invalid image URL</div>
                        </div>
                    `;
                };
                tempImg.src = imageUrl;
            } else {
                imagePreview.innerHTML = `
                    <div class="placeholder">
                        <i class="fas fa-image fa-3x mb-2"></i>
                        <div>No image</div>
                    </div>
                `;
            }
        });
    }
});
</script>
{% endblock %}
